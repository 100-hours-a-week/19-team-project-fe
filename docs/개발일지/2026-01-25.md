# 개발일지 - 2026-01-25

## 작업 요약
- 현직자 탐색 플로우 구현: 홈 검색바 -> 검색 페이지 -> 상세 페이지.
- 현직자 목록/상세 API 연동 및 UI 구성.
- 전환 애니메이션/헤더/CTA 버튼 정리.

## 구현 상세

### 1) 홈 검색 진입 UX 구성
- 홈 배경색 변경 및 검색바 강조(StarBorder) 적용.
- 검색바 위 2줄 멘트 배치.
- 검색바 클릭 시 `/experts`로 이동하면서 슬라이드 전환 기록.
- 홈 하단 레이아웃을 흰색 패널로 분리.

### 2) 현직자 검색 페이지
- 초기 진입 시 API 호출하지 않고 빈 상태 유지.
- 입력 디바운스 시 목록 갱신, 검색 버튼 제출 시 카드 그리드 렌더.
- 검색 결과 카드: 이름/이미지/자세히보기 텍스트 구성(3열 고정).
- 검색 페이지 상단에 뒤로가기 헤더 추가(홈으로 이동).
- 네트워크 오류 시 페이지 내 오류 메시지 표시.

### 3) 상세 페이지 추가
- `/experts/[id]` 라우트 신설, 상세 API 연동.
- 상세 헤더 뒤로가기 버튼 -> 검색 페이지 복귀.
- 하단 고정 CTA 버튼(채팅 요청하기) + 심볼 아이콘 추가.
- 상세 API 에러 메시지 노출.

### 4) 전환 애니메이션
- 페이지 전환 방향(forward/back)을 sessionStorage로 전달.
- 홈 -> 검색: 오른쪽에서 왼쪽 슬라이드.
- 검색/상세 -> 뒤로가기: 왼쪽에서 오른쪽 슬라이드.

## 트러블슈팅

### 이슈 A) `/experts/NaN` 요청 발생
- 증상: 상세 페이지 진입 시 `/api/v1/experts/NaN` 호출로 500 에러.
- 원인: 라우트 파라미터 파싱 실패.
- 해결: `params` 파싱을 `parseInt`로 변경하고 NaN 방어 로직 추가.

### 이슈 B) `params is a Promise and must be unwrapped`
- 증상: `/experts/[id]` 진입 시 런타임 에러.
- 원인: Next.js App Router에서 `params`가 Promise로 전달되는 모드.
- 해결: 페이지 컴포넌트를 `async`로 전환하고 `await params` 처리.

## 파일/폴더 변경 요약
- 홈/탐색 UI
  - `src/app/page.tsx`
  - `src/widgets/search-bar/ui/SearchBar.tsx`
  - `src/shared/ui/star-border/StarBorder.tsx`
  - `tailwind.config.ts`
  - `src/shared/ui/page-transition/PageTransition.tsx`
  - `src/app/globals.css`
- 검색 페이지
  - `src/app/experts/page.tsx`
  - `src/widgets/expert-search/ui/ExpertSearchPage.tsx`
  - `src/widgets/expert-search/ui/ExpertSearchHeader.tsx`
- 상세 페이지
  - `src/app/experts/[id]/page.tsx`
  - `src/widgets/expert-detail/ui/ExpertDetailPage.tsx`
  - `src/widgets/expert-detail/ui/ExpertDetailHeader.tsx`
- API/도메인
  - `src/entities/experts/api/getExperts.ts`
  - `src/entities/experts/api/getExpertDetail.ts`
  - `src/entities/experts/index.ts`

## 결과 요약
- 홈 -> 검색 -> 상세 탐색 플로우 완성.
- 목록/상세 API 연동 및 UI 구성 완료.
- 뒤로가기/전환 애니메이션 적용으로 흐름 명확화.

## 다음 작업 메모
- 상세 페이지 UI 확장(스킬/평점/검증 배지).
- 검색 페이지 필터(job/skill/career) 연동.

---

## 추가 작업 - 채팅

## 작업 요약
- 현직자 상세에서 채팅 요청 API 연동 및 로그인 가드 처리.
- 채팅 목록/메시지 API에 인증 헤더 적용 및 BFF 보강.
- 채팅방 UX 개선(좌우 정렬, 최신 정렬, 자동 스크롤, 즉시 전송 표시).
- 메시지 읽음 처리 API 연동.

## 구현 상세

### 1) 채팅 요청 생성
- 현직자 상세 CTA 클릭 시 로그인 확인 후 채팅 생성 호출.
- `resume_id=1`, `request_type=COFFEE_CHAT`, `job_post_url` 더미로 고정.
- 기존 채팅방 존재 시 목록에서 매칭 후 해당 채팅방으로 이동.
- 관련 파일: `src/widgets/expert-detail/ui/ExpertDetailPage.tsx`,
  `src/features/chat/api/createChat.ts`,
  `src/app/api/chat/route.ts`,
  `src/features/chat/server/createChat.server.ts`

### 2) 채팅 목록/메시지 API 연동 개선
- 클라이언트 요청에 `Authorization` 헤더를 자동 첨부.
- BFF에서 Authorization 헤더를 우선 사용하도록 수정.
- 관련 파일: `src/features/chat/api/getChatList.ts`,
  `src/features/chat/api/getChatMessages.ts`,
  `src/app/api/chat/route.ts`,
  `src/app/api/chat/[chatId]/messages/route.ts`,
  `src/features/chat/server/getChatList.server.ts`,
  `src/features/chat/server/getChatMessages.server.ts`

### 3) 채팅방 UI/UX
- `user_id` 쿠키 저장으로 내/상대 메시지 좌우 정렬.
- 최신 메시지가 하단에 오도록 정렬(시간/ID 기준).
- 전송 즉시 optimistic 메시지 표시.
- 진입/수신 시 자동 스크롤로 최신 메시지 노출.
- 전송 버튼 아이콘 적용 및 원형 버튼 스타일.
- 관련 파일: `src/widgets/chat-room/ui/ChatRoom.tsx`,
  `src/app/api/auth/kakao/login/route.ts`,
  `src/features/auth/server/setAuthCookies.server.ts`,
  `src/features/auth/server/signup.server.ts`

### 4) 메시지 읽음 처리
- `PATCH /api/v1/chats/messages/read` 연동(BFF 포함).
- 채팅방 진입/실시간 수신 시 상대 메시지 읽음 처리 호출.
- 관련 파일: `src/features/chat/api/markChatRead.ts`,
  `src/app/api/chat/messages/read/route.ts`,
  `src/features/chat/server/markChatRead.server.ts`,
  `src/widgets/chat-room/ui/ChatRoom.tsx`

### 5) WS 연결/토큰 처리 (로컬 기준)
- 로그인/회원가입 직후 WS 연결 시도.
- 개발 환경에서 AT를 JS로 읽어 헤더 인증 가능하도록 응답/쿠키 조정.
- 공통 AT 리더 추가.
- 관련 파일: `src/widgets/auth/ui/KakaoCallbackClient.tsx`,
  `src/widgets/onboarding/ui/OnboardingProfileForm.tsx`,
  `src/app/api/auth/kakao/login/route.ts`,
  `src/shared/api/accessToken.ts`
