# ê°œë°œì¼ì§€ - 2026-01-29

## ì‘ì—… ìš”ì•½
- í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë¡œë“œ í”Œë¡œìš° ì¶”ê°€: presigned URL ë°œê¸‰ â†’ S3 PUT â†’ ì‚¬ìš©ì í”„ë¡œí•„ ì—…ë°ì´íŠ¸.
- BFF í”„ë¡ì‹œ(`/bff/uploads/presigned-url`) ì¶”ê°€ ë° ì—…ë¡œë“œ í´ë¼ì´ì–¸íŠ¸ í—¬í¼ êµ¬í˜„.
- í”„ë¡œí•„ ì´ë¯¸ì§€ null ì²˜ë¦¬ ì‹œ ê¸°ë³¸ ì´ë¯¸ì§€(`char_icon.png`)ë¡œ í‘œì‹œ.
- ì „ë¬¸ê°€ ê²€ìƒ‰ ë¦¬ìŠ¤íŠ¸ì—ì„œ `profile_image_url` ì‚¬ìš©í•˜ë„ë¡ ë³€ê²½.
- S3 ì—…ë¡œë“œ CORS/GET ì ‘ê·¼ ì´ìŠˆ í™•ì¸ ë° ì¸í”„ë¼ í˜‘ì˜ í•„ìš” ì‚¬í•­ ì •ë¦¬.

---

## ğŸ“Œ ë³€ê²½ ì‚¬í•­
- í”„ë¡œí•„ ì´ë¯¸ì§€ ì—…ë¡œë“œ ì—°ë™(BFF â†’ presigned URL â†’ S3 PUT â†’ profile_image_url ì—…ë°ì´íŠ¸) ì¶”ê°€
- í”„ë¡œí•„ ì´ë¯¸ì§€ í‘œì‹œ ë¡œì§ì„ `profile_image_url` ê¸°ë°˜ìœ¼ë¡œ ë³€ê²½í•˜ê³  nullì€ ê¸°ë³¸ ì´ë¯¸ì§€ ì²˜ë¦¬
- ì „ë¬¸ê°€ ê²€ìƒ‰ ë¦¬ìŠ¤íŠ¸ ì¹´ë“œì—ì„œ ë”ë¯¸ ì´ë¯¸ì§€ ì œê±° í›„ ì‹¤ì œ í”„ë¡œí•„ ì´ë¯¸ì§€ ë…¸ì¶œ

## ğŸ” ìƒì„¸ ë‚´ìš©
- ì—…ë¡œë“œ í”Œë¡œìš°: `/bff/uploads/presigned-url`ì—ì„œ `presigned_url`, `file_url`ì„ ë°›ì•„ PUT ì—…ë¡œë“œ í›„ `/bff/users/me` PATCHì— `profile_image_url` í¬í•¨
- ì‘ë‹µ í‚¤ê°€ ìŠ¤ë„¤ì´í¬ ì¼€ì´ìŠ¤ë¼ ë§¤í•‘ ì²˜ë¦¬(`presigned_url` â†’ `presignedUrl`, `file_url` â†’ `fileUrl`)
- S3 CORS/GET 403 ì´ìŠˆ í™•ì¸: ë¸Œë¼ìš°ì € PUT preflight í—ˆìš© ë° ê³µê°œ ì ‘ê·¼ ë˜ëŠ” presigned GET ì „ëµ í•„ìš”

---

## ìƒì„¸ ë³€ê²½ ì‚¬í•­

### 1) Presigned URL ë°œê¸‰ ì—°ë™
- BFF ë¼ìš°íŠ¸ ì¶”ê°€
  - `POST /bff/uploads/presigned-url` â†’ `/api/v1/uploads/presigned-url` ì „ë‹¬
- í´ë¼ì´ì–¸íŠ¸ API ì¶”ê°€
  - `createPresignedUrl()`ë¡œ ë°œê¸‰ ìš”ì²­
  - ì‘ë‹µ í‚¤(`presigned_url`, `file_url`) ë§¤í•‘ ì²˜ë¦¬
- S3 ì—…ë¡œë“œ í—¬í¼ ì¶”ê°€
  - `uploadToPresignedUrl()`ë¡œ PUT ì—…ë¡œë“œ

### 2) ë§ˆì´í˜ì´ì§€ ìˆ˜ì •(/me/edit) ì´ë¯¸ì§€ ì—…ë¡œë“œ
- ì´ë¯¸ì§€ ì„ íƒ UI ì¶”ê°€
  - íŒŒì¼ ì„ íƒ â†’ ë¯¸ë¦¬ë³´ê¸° â†’ ì €ì¥ ì‹œ ì—…ë¡œë“œ
- ì €ì¥ í”Œë¡œìš°
  - presigned URL ë°œê¸‰ â†’ S3 PUT â†’ `profile_image_url` í¬í•¨í•˜ì—¬ `/bff/users/me` PATCH
- ì—…ë¡œë“œ ì¤‘ ìƒíƒœ ì²˜ë¦¬ ë° ì˜¤ë¥˜ ë©”ì‹œì§€ ì¶”ê°€

### 3) ê¸°ë³¸ ì´ë¯¸ì§€/í”„ë¡œí•„ ì´ë¯¸ì§€ ì ìš©
- ë§ˆì´í˜ì´ì§€ ë° ì „ë¬¸ê°€ ìƒì„¸/ë¦¬ìŠ¤íŠ¸ì—ì„œ `profile_image_url` ìš°ì„  ì‚¬ìš©
- nullì¼ ê²½ìš° `src/shared/icons/char_icon.png`ë¡œ fallback

---

## íŒŒì¼ ë³€ê²½ ëª©ë¡

### ì‹ ê·œ ì¶”ê°€
- `src/app/bff/uploads/presigned-url/route.ts`
- `src/features/uploads/api/createPresignedUrl.ts`
- `src/features/uploads/api/uploadToPresignedUrl.ts`
- `src/features/uploads/index.ts`

### ìˆ˜ì •
- `src/widgets/my-page-edit/ui/MyPageEdit.tsx`
- `src/widgets/my-page/ui/MyPage.tsx`
- `src/widgets/expert-detail/ui/ExpertDetailPage.tsx`
- `src/widgets/expert-search/ui/ExpertSearchPage.tsx`
- `src/features/uploads/api/createPresignedUrl.ts`

---

## í…ŒìŠ¤íŠ¸/í™•ì¸ ì‚¬í•­
- `/me/edit`ì—ì„œ ì´ë¯¸ì§€ ì—…ë¡œë“œ â†’ presigned URL ë°œê¸‰ â†’ PUT ì—…ë¡œë“œ â†’ í”„ë¡œí•„ ì €ì¥ ë™ì‘ í™•ì¸
- `profile_image_url`ì´ nullì¸ ê²½ìš° ê¸°ë³¸ ì´ë¯¸ì§€ í‘œì‹œ í™•ì¸

---

## ì¸í”„ë¼/ë°±ì—”ë“œ í˜‘ì˜ í•„ìš”
- S3 CORS ì„¤ì • í•„ìš”: ë¸Œë¼ìš°ì € PUT preflight(OPTIONS) 403 ë°œìƒ
- ê°ì²´ GET 403 ë°œìƒ: í˜„ì¬ private ìƒíƒœë¡œ `fileUrl` ì§ì ‘ ì ‘ê·¼ ë¶ˆê°€
  - í•´ê²°ì•ˆ: public-read í—ˆìš© ë˜ëŠ” presigned GET ë°œê¸‰ API ì œê³µ
