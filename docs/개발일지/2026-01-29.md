# 개발일지 - 2026-01-29

## 작업 요약
- 프로필 이미지 업로드 플로우 추가: presigned URL 발급 → S3 PUT → 사용자 프로필 업데이트.
- BFF 프록시(`/bff/uploads/presigned-url`) 추가 및 업로드 클라이언트 헬퍼 구현.
- 프로필 이미지 null 처리 시 기본 이미지(`char_icon.png`)로 표시.
- 전문가 검색 리스트에서 `profile_image_url` 사용하도록 변경.
- S3 업로드 CORS/GET 접근 이슈 확인 및 인프라 협의 필요 사항 정리.

---

## 상세 변경 사항

### 1) Presigned URL 발급 연동
- BFF 라우트 추가
  - `POST /bff/uploads/presigned-url` → `/api/v1/uploads/presigned-url` 전달
- 클라이언트 API 추가
  - `createPresignedUrl()`로 발급 요청
  - 응답 키(`presigned_url`, `file_url`) 매핑 처리
- S3 업로드 헬퍼 추가
  - `uploadToPresignedUrl()`로 PUT 업로드

### 2) 마이페이지 수정(/me/edit) 이미지 업로드
- 이미지 선택 UI 추가
  - 파일 선택 → 미리보기 → 저장 시 업로드
- 저장 플로우
  - presigned URL 발급 → S3 PUT → `profile_image_url` 포함하여 `/bff/users/me` PATCH
- 업로드 중 상태 처리 및 오류 메시지 추가

### 3) 기본 이미지/프로필 이미지 적용
- 마이페이지 및 전문가 상세/리스트에서 `profile_image_url` 우선 사용
- null일 경우 `src/shared/icons/char_icon.png`로 fallback

---

## 파일 변경 목록

### 신규 추가
- `src/app/bff/uploads/presigned-url/route.ts`
- `src/features/uploads/api/createPresignedUrl.ts`
- `src/features/uploads/api/uploadToPresignedUrl.ts`
- `src/features/uploads/index.ts`

### 수정
- `src/widgets/my-page-edit/ui/MyPageEdit.tsx`
- `src/widgets/my-page/ui/MyPage.tsx`
- `src/widgets/expert-detail/ui/ExpertDetailPage.tsx`
- `src/widgets/expert-search/ui/ExpertSearchPage.tsx`
- `src/features/uploads/api/createPresignedUrl.ts`

---

## 테스트/확인 사항
- `/me/edit`에서 이미지 업로드 → presigned URL 발급 → PUT 업로드 → 프로필 저장 동작 확인
- `profile_image_url`이 null인 경우 기본 이미지 표시 확인

---

## 인프라/백엔드 협의 필요
- S3 CORS 설정 필요: 브라우저 PUT preflight(OPTIONS) 403 발생
- 객체 GET 403 발생: 현재 private 상태로 `fileUrl` 직접 접근 불가
  - 해결안: public-read 허용 또는 presigned GET 발급 API 제공

