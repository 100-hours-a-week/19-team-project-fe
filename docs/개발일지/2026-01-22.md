# 개발일지 - 2026-01-22

## 작업 요약
- 회원가입 API를 `/api/v3/auth/signup`로 변경하고 응답 타입을 반영.
- 회원가입 성공 시 AT/RT를 쿠키에 저장하고 메인으로 이동.
- 에러 코드 매핑을 추가해 가입 실패 메시지를 UI에 표시.
- 닉네임/자기소개 입력 제약(글자 수 제한 및 카운트) 적용.
- 가입 성공 시 메인에서 Lottie 폭죽 1회 재생 구현.
- Lottie 라이브러리 추가 및 JSON 에셋 배치.

## 구현 상세
### 회원가입 API 연동
- 위치: `src/features/auth/signup/api/`
  - `signup.ts`
    - 경로를 `/api/v3/auth/signup`로 변경.
    - 성공 코드 `CREATED`로 처리.
    - 응답 타입을 `SignupResponse`로 반환하도록 변경.
  - `types.ts`
    - 응답 타입 `SignupResponse` 추가(`user_id`, `access_token`, `refresh_token`).
  - `index.ts`
    - `SignupResponse` export 추가.

### 회원가입 요청/응답 처리 흐름
- 위치: `src/widgets/onboarding/ui/OnboardingProfileForm.tsx`
  - 요청 payload 규칙
    - `oauth_provider`: 고정 `'KAKAO'`.
    - `oauth_id`: 소셜 로그인 결과에서 추출.
    - `email`: 공백(`''`)으로 고정.
  - 성공 처리
    - `access_token`, `refresh_token`을 기본 쿠키로 저장.
    - `sessionStorage`에 `signupSuccess=1` 플래그 저장.
    - 성공 시 `router.replace('/')`로 메인 이동.
  - 에러 처리
    - `BusinessError`의 `code`를 메시지로 매핑해 하단에 노출.
    - 매핑 코드: `SIGNUP_OAUTH_PROVIDER_INVALID`, `SIGNUP_OAUTH_ID_EMPTY`, `NICKNAME_EMPTY`,
      `SIGNUP_USER_TYPE_INVALID`, `CAREER_LEVEL_NOT_FOUND`.

### 입력 UX 개선
- 위치: `src/widgets/onboarding/ui/OnboardingProfileForm.tsx`
  - 닉네임 최대 10자 제한(`maxLength=10`) 및 카운트 표시.
  - 자기소개 최대 300자 제한(`maxLength=300`) 및 카운트 표시.
  - 닉네임 고정 헬퍼 텍스트 제거.

### 가입 성공 Lottie 폭죽 재생
- 위치: `src/widgets/home/ui/SignupConfetti.tsx`
  - 메인 진입 시 `sessionStorage`의 `signupSuccess` 플래그를 확인.
  - `public/lottie/signup-confetti.json`을 fetch하여 Lottie 1회 재생.
  - 재생 완료 시 플래그 제거 및 컴포넌트 제거.
- 위치: `src/widgets/home/ui/HomeContent.tsx`
  - `SignupConfetti`를 메인 영역에 추가해 전면 재생.
- 에셋
  - `public/lottie/signup-confetti.json` 추가.
- 라이브러리
  - `lottie-react` 추가 (`package.json`, `pnpm-lock.yaml`).

## 파일/폴더 변경 요약
- `src/features/auth/signup/api/signup.ts`
- `src/features/auth/signup/api/types.ts`
- `src/features/auth/signup/api/index.ts`
- `src/widgets/onboarding/ui/OnboardingProfileForm.tsx`
- `src/widgets/home/ui/SignupConfetti.tsx`
- `src/widgets/home/ui/HomeContent.tsx`
- `public/lottie/signup-confetti.json`
- `package.json`
- `pnpm-lock.yaml`

## 데이터 흐름 정리
1) 온보딩 제출 → `/api/v3/auth/signup` 호출  
2) 성공 응답 수신 → 쿠키에 AT/RT 저장  
3) `signupSuccess` 플래그 저장 → 메인 이동  
4) 메인에서 플래그 감지 → Lottie 폭죽 1회 재생 → 플래그 삭제

## 다음 작업 메모
- 에러 메시지 UI 위치/스타일을 폼 정책에 맞게 조정할지 검토.
- 토큰 저장 정책(쿠키 옵션/만료) 세부 기준 확정 필요.

---

## 회원가입 연동 추가 정리 (상세)

### 1) 소셜 로그인 응답 저장 → 온보딩 연동
- `SIGNUP_REQUIRED` 응답에서 필요한 값을 온보딩에서 쓰기 위해 세션 저장소에 결과 저장.
- 위치: `src/widgets/auth/social-login/ui/KakaoCallbackClient.tsx`
  - `sessionStorage.setItem('kakaoLoginResult', JSON.stringify(result))`
- 기대 효과: 온보딩에서 `oauth_id`를 실제 카카오 응답에서 가져올 수 있음.

### 2) 온보딩에서 oauth_id 파싱 로직 정합성 수정
- 실제 응답 구조가 `signup_required`(snake_case)로 내려오는 형태라 기존 `signupRequired.providerUserId` 파싱이 실패했음.
- 위치: `src/widgets/onboarding/ui/OnboardingProfileForm.tsx`
  - 파싱 경로 수정:
    - `parsed.signup_required.oauth_id` → `oauth_id`
    - `parsed.signup_required.nickname` → 닉네임 fallback
  - `email`은 공백(`''`)으로 고정 전송.

### 3) 가입 요청 직전 디버깅 payload 알림 추가
- 버튼 클릭 시(유효성 검사 전) 실제로 구성되는 payload를 확인하기 위해 알럿 표시.
- 위치: `src/widgets/onboarding/ui/OnboardingProfileForm.tsx`
  - `alert(JSON.stringify(debugPayload, null, 2))`
  - 폼 상태/선택값/닉네임/카카오 oauth_id 확인 목적.

### 4) 성공 코드 처리 정합성
- v1 응답 `code=OK`를 성공으로 처리하도록 수정.
- 위치: `src/features/auth/signup/api/signup.ts`
  - `successCodes: ['OK', 'CREATED']`

### 5) 버튼 클릭이 막히는 현상 해결
- BottomSheet 루트 컨테이너가 `pointer-events-auto`로 전체 클릭을 가로채는 문제 수정.
- 위치: `src/shared/ui/bottom-sheet/BottomSheet.tsx`
  - 루트: `pointer-events-none`
  - backdrop/시트만 `pointer-events-auto`

### 6) 회원가입 성공 후 스플래시 스킵
- 가입 성공 플래그(`sessionStorage.signupSuccess`)가 있으면 스플래시를 건너뛰도록 처리.
- 위치: `src/widgets/splash-screen/ui/SplashGate.tsx`
  - 초기 상태에서 플래그를 확인해 `showSplash`를 결정.

### 7) 린트 규칙 조정
- `react-hooks/set-state-in-effect` 규칙 비활성화.
- 위치: `eslint.config.mjs`

### 8) 토큰 저장 위치
- 회원가입 성공 시 AT/RT를 쿠키에 저장.
- 위치: `src/widgets/onboarding/ui/OnboardingProfileForm.tsx`
  - `document.cookie = access_token=...`
  - `document.cookie = refresh_token=...`

### 9) 화면 이동 흐름
- 회원가입 성공 시 메인(`/`) 이동.
- 위치: `src/widgets/onboarding/ui/OnboardingProfileForm.tsx`
  - `router.replace('/')`

### 10) 파일 변경 목록 (회원가입 관련)
- `src/widgets/auth/social-login/ui/KakaoCallbackClient.tsx`
- `src/widgets/onboarding/ui/OnboardingProfileForm.tsx`
- `src/features/auth/signup/api/signup.ts`
- `src/shared/ui/bottom-sheet/BottomSheet.tsx`
- `src/widgets/splash-screen/ui/SplashGate.tsx`
- `eslint.config.mjs`
