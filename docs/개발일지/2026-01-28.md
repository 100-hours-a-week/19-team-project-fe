# 개발일지 - 2026-01-28

## 작업 요약
- 마이페이지(/me) UI 구축 및 프로필 카드/액션 버튼 구성, 기본 프로필 이미지 흑백 처리.
- 프로필 수정 페이지(/me/edit) 신규 추가: 닉네임/직무/경력/기술스택/자기소개 수정 + PATCH 연동.
- 현직자 이메일 인증 페이지(/me/verify) 신규 추가: 회원가입의 이메일 인증 UI/키패드와 동일하게 구현.
- 로그인 가드 로직 공통화(shared) 및 마이페이지에 적용.
- BFF `/bff/users/me` GET/PATCH 라우트 추가 및 사용자 조회/수정 API 연결.
- API path suffix(`/local`)를 특정 엔드포인트에만 적용할 수 있도록 설정 확장.

---

## 상세 변경 사항

### 1) 마이페이지(/me) 화면 구성
- 기본 프로필 카드 구성
  - 기본 프로필 이미지: `src/shared/icons/profile_basic.png` 사용
  - 이미지 흑백 처리(`grayscale`) 적용
  - 프로필 카드 우측 상단에 파란 연필 버튼 배치 (프로필 수정 이동)
  - 닉네임/직무 텍스트 노출
  - 직무 하단에 경력 + 기술스택 태그(회원가입 태그 스타일) 노출
- 카드 크기 조정
  - 상단 카드 높이 축소(`py-8 -> py-6`)
  - 프로필 이미지 사이즈 축소(112px → 96px)
  - 닉네임 폰트/여백 축소
- 자기소개 블록
  - 별도 카드 블록으로 분리, `introduction` 렌더
- 하단 액션 버튼 구성
  - `이력서 관리`, `현직자 인증하기`, `문의하기` 버튼 유지
  - 아이콘 교체:
    - 이력서 관리: `src/shared/icons/icon_resume.png`
    - 현직자 인증하기: `src/shared/icons/icon_certification.png`
    - 문의하기: `src/shared/icons/icon_inquiry.png`
  - 현재 이력서 관리/현직자 인증하기는 `/me/verify` 이동 연결

### 2) 프로필 수정 페이지(/me/edit)
- 신규 라우트 및 위젯 구성
  - `src/app/me/edit/page.tsx` 생성
  - `src/widgets/my-page-edit/ui/MyPageEdit.tsx` 구현
- UI 구성 (회원가입 프로필 입력과 동일 톤)
  - 닉네임 입력 카드: 흰색 블록 + 하단라인 인풋 + 중복확인 버튼
  - 중복확인 버튼 디자인은 회원가입과 동일
  - 직무/경력/기술스택 선택 버튼 스타일 동일화
  - 선택된 직무/경력도 pill 태그로 표시
  - 자기소개 입력 카드 유지
  - 저장 버튼에 심볼 아이콘 `icon-mark.png` 적용, 공용 `Button` 사용
- 로직 구성
  - 닉네임 변경 시에만 중복 확인 필요하도록 분기
  - 변경된 필드만 PATCH payload에 포함되도록 비교 로직 추가
  - 기술스택 최대 5개 제한 및 초과 시 안내 메시지
  - 기술스택 리스트 스크롤바 숨김 처리

### 3) 현직자 이메일 인증 페이지(/me/verify)
- 신규 라우트 및 위젯 구성
  - `src/app/me/verify/page.tsx` 생성
  - `src/widgets/my-page-verify/ui/MyPageVerify.tsx` 구현
- 회원가입 이메일 인증 UI 복제
  - 이메일 입력 하단라인 스타일 + 전송 버튼(원형 아이콘)
  - 인증번호 6자리 도트 표시
  - 숫자 키패드(생체/백스페이스 포함) 디자인 동일
  - 인증 상태 메시지(진행/완료/오류/남은 시간) 동일 노출
- 로그인 가드
  - 비로그인 시 `/me`로 리다이렉트

### 4) 공통 로그인 가드(shared) 정리
- `useAuthGate` 훅 생성: 로그인 체크 상태 관리(authed/guest/checking)
- `AuthGateSheet` 컴포넌트 생성: 로그인 필요 바텀시트 공용화
- 마이페이지/채팅 등에서 공통 가드 사용

### 5) 사용자 정보 조회/수정 API 연동
- BFF 라우트 추가
  - `GET /bff/users/me` → `/api/v1/users/me` 전달
  - `PATCH /bff/users/me` → `/api/v1/users/me` 전달
- 클라이언트 API 추가
  - `getUserMe()` 추가
  - `updateUserMe()` 추가
- 수정 요청(payload)
  - `skills: [{ skill_id, display_order }]` 형태 유지
  - 변경된 필드만 전송하도록 구성

### 6) API path suffix 설정 보완
- `NEXT_PUBLIC_API_PATH_SUFFIX_TARGETS` 추가
  - 특정 경로에만 `/local`이 붙도록 처리
  - 로그인/회원가입 관련 엔드포인트만 suffix 적용 가능

---

## 파일 변경 목록

### 신규 추가
- `src/app/me/edit/page.tsx`
- `src/app/me/verify/page.tsx`
- `src/widgets/my-page-edit/ui/MyPageEdit.tsx`
- `src/widgets/my-page-edit/index.ts`
- `src/widgets/my-page-verify/ui/MyPageVerify.tsx`
- `src/widgets/my-page-verify/index.ts`
- `src/features/users/api/getUserMe.ts`
- `src/features/users/api/updateUserMe.ts`

### 수정
- `src/widgets/my-page/ui/MyPage.tsx`
- `src/widgets/footer/ui/Footer.tsx`
- `src/shared/api/endpoints.ts`
- `src/app/bff/users/me/route.ts`
- `src/features/users/index.ts`
- `src/widgets/chat-list/ui/ChatList.tsx`

---

## 테스트/확인 사항
- `/me` 진입 시 사용자 정보 정상 노출 확인
- `/me/edit` 저장 시 변경된 필드만 PATCH 요청되는지 확인
- 기술스택 최대 5개 제한 및 오류 메시지 확인
- `/me/verify` 이메일 인증 UI/키패드 동작 확인
- `/bff/users/me` GET/PATCH 정상 동작 확인

---

## 메모
- 기술스택 PATCH가 백엔드에서 500 발생했던 이슈: payload 포맷을 `skill_id` 형태로 유지 필요.
- 로그인/회원가입용 `/local` suffix 적용 범위는 `NEXT_PUBLIC_API_PATH_SUFFIX_TARGETS`로 제어 가능.

---

## 추가 수정
- 이력서 업데이트 폼에서 `Input.Field`를 `Input.Root` 없이 쓰던 구간을 일반 `input`으로 교체해 런타임 오류 수정.

---

## 추가 작업 - 이력서 기능 정리

### 1) 이력서 목록/상세/생성/삭제 API 연동
- 목록 조회
  - `GET /api/v1/resumes` → BFF `GET /bff/resumes` 프록시 추가
  - 클라이언트 `getResumes()` 추가 및 응답 키 스네이크/카멜케이스 정규화
  - 목록 로딩/에러 상태 처리, 이력서 없을 때 캐릭터 노출 유지
- 상세 조회
  - `GET /api/v1/resumes/{resume_id}` → BFF `GET /bff/resumes/[resumeId]`
  - 상세 페이지 `/resume/[resumeId]` 생성 및 상세 데이터 표시
  - `params` Promise 이슈 해결(Next.js sync dynamic API 오류)
- 생성
  - `POST /api/v1/resumes` → BFF `POST /bff/resumes`
  - 생성 폼(`resume/edit`)에서 필수값 검증 후 생성 호출
  - 더미 데이터 제거 및 제출 payload 미리보기 제거
- 삭제
  - `DELETE /api/v1/resumes/{resume_id}` → BFF `DELETE /bff/resumes/[resumeId]`
  - 리스트 옵션 메뉴에서 삭제 실행(Confirm 후 목록에서 제거)

### 2) 이력서 수정(제목만) 연동
- 제목 수정 API
  - `PATCH /api/v1/resumes/{resume_id}/title` → BFF `PATCH /bff/resumes/[resumeId]/title`
  - `updateResumeTitle()` 추가
- 수정 플로우
  - 리스트 옵션 “수정” 클릭 시 `/resume/edit?resumeId=...` 이동
  - edit 페이지에서 상세 조회 후 폼에 프리필
  - 제출 시 수정 모드면 제목만 업데이트 처리

### 3) 이력서 UI/UX 개선
- 리스트
  - 카드 우측 상단 옵션(점 3개) 토글로 수정/삭제 제공
  - 카드 전체 클릭 시 상세 이동(중첩 버튼 이슈 해결)
  - 리스트에서 신입/학력 라인 제거, 등록일 간격 축소
  - 제목 폰트 12px로 조정
- 생성/수정 폼
  - 신입/경력 선택을 버튼형 토글로 변경
  - 학력은 상단에 위치, 5개 옵션 버튼형 단일 선택으로 변경
  - 신입 선택 시 경력 입력 블록 숨김
  - 추가 버튼으로 생성되는 입력 간 간격 추가

### 4) 상세 내용 렌더링
- `content_json`을 가공하여 요약/경력/프로젝트/학력/수상/자격증/활동으로 분리 렌더링
- JSON 그대로 출력하던 UI를 사람이 읽기 쉬운 리스트 형태로 변경

---

## 이력서 관련 변경 파일

### 신규 추가
- `src/app/bff/resumes/route.ts`
- `src/app/bff/resumes/[resumeId]/route.ts`
- `src/app/bff/resumes/[resumeId]/title/route.ts`
- `src/entities/resumes/api/getResumes.ts`
- `src/entities/resumes/api/getResumeDetail.ts`
- `src/entities/resumes/api/createResume.ts`
- `src/entities/resumes/api/deleteResume.ts`
- `src/entities/resumes/api/updateResumeTitle.ts`
- `src/entities/resumes/index.ts`
- `src/app/resume/[resumeId]/page.tsx`
- `src/widgets/resume-detail/ui/ResumeDetailPage.tsx`
- `src/widgets/resume-detail/index.ts`

### 수정
- `src/widgets/resume/ui/ResumePage.tsx`
- `src/widgets/resume-edit/ui/ResumeEditPage.tsx`
